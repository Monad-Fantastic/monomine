<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <!-- Strict CSP; no unsafe-eval needed -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' https:;
                 script-src 'self' https://esm.sh 'unsafe-inline';
                 connect-src *;
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' data: https:;
                 object-src 'none';">
  <title>MonoMine — Monad Game Jam</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="wrap">
    <h1>MonoMine <span class="pill">Monad Testnet</span>
<button id="tmfInfoBtn" class="ghost small">What is TMF?</button>
    </h1>
    <p class="sub">Daily micro-PoW. TMF Passport required. Gasless supported via TMF Gas Station (Open Mode).</p>
  </header>




  <main class="wrap">
    <section class="grid">
      <div class="card">
        <h3>Wallet</h3>

        <div class="row">
          <button id="connectBtn">Connect</button>
          <button id="addNetworkBtn" class="ghost">Add Monad Testnet</button>
        </div>

        <div class="muted" id="status">Not connected</div>
        <div class="muted small">
          <span id="passportStatus">Passport: —</span>
        </div>

        <div class="row">
          <button id="mintBtn" class="ghost">Mint Passport</button>
          <a id="viewAddr" class="link" target="_blank" rel="noreferrer">View on Explorer</a>
        </div>

        <p class="wallet-help small muted">
          No wallet? <a class="link" target="_blank"
            href="https://metamask.io/download.html">Get MetaMask</a> •
          Need network? <a class="link" target="_blank"
            href="https://docs.monad.xyz/guides/add-monad-to-wallet/metamask">Add Monad</a>
        </p>
      </div>


      <div class="card callout">
        <h3>No wallet? Use Farcaster.</h3>
        <p class="muted">
          You can play <b>gasless</b> using your Farcaster ID with <b>Monad Fantastic (TMF) Passport</b>.
        </p>
        <ol class="muted small">
          <li>Install Warpcast (the Farcaster app) and get your Farcaster ID (FID).</li>
          <li>Click <b>Mint Passport</b> — TMF will create/mint for you (no tokens needed).</li>
          <li>Return here and click <b>Connect</b> (your new Passport-linked wallet will work).</li>
          <li>Hit <b>Start Mining</b> → <b>Submit Best</b> (keep <b>Gasless via TMF</b> checked).</li>
        </ol>
        <div class="row">
          <button id="mintBtn2">Mint Passport</button>
        </div>
      </div>

      <div class="card">
        <h3>Today</h3>
        <div>Epoch (day): <b id="day">—</b></div>
        <div>Seed: <code id="seed">0x</code></div>
        <div class="row">
          <button id="rollBtn" class="ghost">Roll if needed</button>
          <span id="rollMsg" class="muted"></span>
        </div>
        <div class="leader">
          <div class="muted">Current leader</div>
          <div id="leader">—</div>
        </div>
      </div>
    <div class="leaderboard">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h3 style="margin:0">Today’s Leaderboard</h3>
        <span class="muted small" id="lbMeta">loading…</span>
      </div>
      <div class="tablewrap">
        <table class="table" id="todayTable">
          <thead>
            <tr>
              <th>#</th><th>Player</th><th>FID</th><th>Best Hash</th><th>Submits</th><th>When</th>
            </tr>
          </thead>
          <tbody id="todayTbody"></tbody>
        </table>
      </div>
    </div>


      <div class="card wide">
        <h3>Mine</h3>
<p class="muted small" id="howTo">
  Tip: click <b>Start Mining</b> and watch “Best hash”. More leading zeros = better.
  Click <b>Stop</b> and <b>Submit Best</b> when you’re happy. Gasless relay works by default.
</p>
<br>

        <div class="row">
          <button id="mineBtn" disabled>Start Mining</button>
          <button id="submitBtn" disabled>Submit Best</button>
          <label class="muted small"><input type="checkbox" id="useRelay" checked/> Gasless via TMF</label>
        </div>
        <div>Best hash: <code id="bestHash">—</code></div>
        <div>Best nonce: <code id="bestNonce">—</code></div>
        <div id="rate" class="muted small">hashes/s: —</div>

        <div id="bestScore" class="muted small">difficulty: —</div>
        <div id="bestCount" class="muted small">improvements: 0</div>
        <div id="bestAgo" class="muted small">last improve: —</div>

        <br>  
        <div id="txMsg" class="muted"></div>

        <div class="row">
          <button id="shareBtn" class="ghost">Share on Farcaster</button>
          <span class="muted small">Tell your friends your best hash ✨</span>
        </div>
      </div>
    </section>


<div id="tmfModal" class="modal" hidden data-close="1" aria-hidden="true">
  <div class="modal__card" role="dialog" aria-modal="true" aria-labelledby="tmfTitle" tabindex="-1">
    <div class="modal__header">
      <h3 id="tmfTitle">What is TMF Passport?</h3>
      <button id="tmfClose" class="ghost" aria-label="Close">✕</button>
    </div>
    <p class="muted">
      TMF Passport links your Farcaster ID to a gasless wallet on Monad. With it, you can
      play MonoMine and other TMF-enabled apps without holding gas. Don’t have Farcaster?
      You can still play with a normal wallet—Passport is optional.
    </p>
    <ol class="muted small">
      <li>Mint your Passport (one-time, free in Open Mode).</li>
      <li>Return here, Connect, and Start Mining.</li>
      <li>Submit Best (gasless relay is on by default).</li>
    </ol>
    <div class="row">
      <a class="link" target="_blank" href="https://warpcast.com/~/compose?text=Mint%20your%20TMF%20Passport%20to%20play%20MonoMine&embeds[]=https%3A%2F%2Flosarchos.com%2Fframe">Mint Passport</a>
      <a id="whatIsPassport" class="link" target="_blank">Learn more</a>
    </div>
  </div>
</div>


    <footer class="muted small">
      Contract:
      <a class="link" target="_blank" href="https://testnet.monadexplorer.com/address/0x49c52AEb95BEA2E22bede837B77C4e482840751e">MonoMine</a>
      • MIT • TMF Gas Station (Open Mode)
    </footer>
  </main>

  <!-- Load ethers as a pure ESM build to avoid unsafe-eval -->
<script type="module">
  import * as ethersMod from "https://esm.sh/ethers@6.13.2";
  window.ethers = ethersMod;

  import "./game.js";
  import "./ui.js";
</script>
</body>
</html>
