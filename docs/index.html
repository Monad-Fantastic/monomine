<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <!-- Strict CSP; no unsafe-eval needed -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' https:;
                 script-src 'self' https://esm.sh 'unsafe-inline';
                 connect-src *;
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' data: https:;
                 object-src 'none';">
  <title>MonoMine — Monad Game Jam</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="wrap">
    <h1>MonoMine <span class="pill">Monad Testnet</span>
    <button id="tmfInfoBtn" class="ghost smallbtn" aria-haspopup="dialog" aria-controls="tmfModal">
      What is TMF?
    </button>
    </h1>
    <p class="sub">Daily micro-PoW. TMF Passport required. Gasless supported via TMF Gas Station (Open Mode).</p>
  </header>




  <main class="wrap">
    <section class="grid">
      <div class="card">
        <h3>Wallet</h3>

        <div class="row">
          <button id="connectBtn">Connect</button>
          <button id="addNetworkBtn" class="ghost">Add Monad Testnet</button>
        </div>

        <div class="muted" id="status">Not connected</div>
        <div class="muted small">
          <span id="passportStatus">Passport: —</span>
        </div>

        <div class="row">
          <button id="mintBtn" class="ghost">Mint Passport</button>
          <a id="viewAddr" class="link" target="_blank" rel="noreferrer">View on Explorer</a>
        </div>

        <p class="wallet-help small muted">
          No wallet? <a class="link" target="_blank"
            href="https://metamask.io/download.html">Get MetaMask</a> •
          Need network? <a class="link" target="_blank"
            href="https://docs.monad.xyz/guides/add-monad-to-wallet/metamask">Add Monad</a>
        </p>
      </div>


      <div class="card callout">
        <h3>No wallet? Use Farcaster.</h3>
        <p class="muted">
          You can play <b>gasless</b> using your Farcaster ID with <b>Monad Fantastic (TMF) Passport</b>.
        </p>
        <ol class="muted small">
          <li>Install Warpcast (the Farcaster app) and get your Farcaster ID (FID).</li>
          <li>Click <b>Mint Passport</b> — TMF will create/mint for you (no tokens needed).</li>
          <li>Return here and click <b>Connect</b> (your new Passport-linked wallet will work).</li>
          <li>Hit <b>Start Mining</b> → <b>Submit Best</b> (keep <b>Gasless via TMF</b> checked).</li>
        </ol>
        <div class="row">
          <button id="mintBtn2">Mint Passport</button>
        </div>
      </div>

      <div class="card">
        <h3>Today</h3>
        <div>Epoch (day): <b id="day">—</b></div>
        <div>Seed: <code id="seed">0x</code></div>
        <div class="row">
          <button id="rollBtn" class="ghost">Roll if needed</button>
          <span id="rollMsg" class="muted"></span>
        </div>
        <div class="leader">
          <div class="muted">Current leader</div>
          <div id="leader">—</div>
        </div>
      </div>

      <div class="card wide">
        <h3>Mine</h3>
        <div class="row">
          <button id="mineBtn" disabled>Start Mining</button>
          <button id="submitBtn" disabled>Submit Best</button>
          <label class="muted small"><input type="checkbox" id="useRelay" checked/> Gasless via TMF</label>
        </div>
        <div>Best hash: <code id="bestHash">—</code></div>
        <div>Best nonce: <code id="bestNonce">—</code></div>
        <div id="rate" class="muted small">hashes/s: —</div>
        <div id="txMsg" class="muted"></div>
        <div class="row">
          <button id="shareBtn" class="ghost">Share on Farcaster</button>
          <span class="muted small">Tell your friends your best hash ✨</span>
        </div>
      </div>
    </section>


<div id="tmfModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tmfTitle" hidden>
  <div class="modal__scrim" data-close="1"></div>
  <div class="modal__card" role="document" tabindex="-1">
    <div class="modal__head">
      <h3 id="tmfTitle">Monad Fantastic (TMF)</h3>
      <button id="tmfClose" class="ghost smallbtn" aria-label="Close">✕</button>
    </div>

    <div class="modal__body">
      <p><b>TMF Passport</b> links your Farcaster ID to a Monad wallet—so you can play gasless without juggling seed phrases.</p>
      <ul>
        <li><b>Passport mint:</b> 1-click via a Farcaster Frame (no tokens needed).</li>
        <li><b>Gasless transactions:</b> routed through TMF’s EntryForwarder (Open Mode) with sane caps.</li>
        <li><b>Use any wallet:</b> MetaMask works too—Passport just makes it seamless.</li>
      </ul>
      <p class="small muted">
        Open Mode: no tenant keys required; rate-limited & gas-capped by the relay.
      </p>
    </div>

    <div class="modal__foot">
      <a class="link" target="_blank" href="https://losarchos.com/frame">Open Passport Mint Frame</a>
      <span>•</span>
      <a class="link" target="_blank" href="https://docs.monad.xyz/guides/add-monad-to-wallet/metamask">Add Monad to MetaMask</a>
    </div>
  </div>
</div>


    <footer class="muted small">
      Contract:
      <a class="link" target="_blank" href="https://testnet.monadexplorer.com/address/0x49c52AEb95BEA2E22bede837B77C4e482840751e">MonoMine</a>
      • MIT • TMF Gas Station (Open Mode)
    </footer>
  </main>

  <!-- Load ethers as a pure ESM build to avoid unsafe-eval -->
  <script type="module">
    import * as ethersMod from "https://esm.sh/ethers@6.13.2";
    window.ethers = ethersMod; // expose for app.js
    import "./app.js?v=9";
  </script>
</body>
</html>
